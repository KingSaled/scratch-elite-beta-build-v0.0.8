{"version":3,"file":"HoloFoilFilter-D1e3Fbo_.js","sources":["../../src/effects/HoloFoilFilter.ts"],"sourcesContent":["/* @ts-nocheck */\r\nimport {\r\n  Container,\r\n  Sprite,\r\n  Graphics,\r\n  Assets,\r\n  BlurFilter,\r\n  Ticker,\r\n} from 'pixi.js';\r\n\r\ninterface HoloOpts {\r\n  alpha?: number;\r\n  radius?: number;\r\n\r\n  bloom?: boolean;\r\n  bloomStrength?: number;\r\n  bloomLevels?: number;\r\n\r\n  sweep?: boolean;\r\n  sweepWidth?: number; // px\r\n  sweepSpeed?: number; // px/sec\r\n  sweepInterval?: number; // sec between passes\r\n  sweepAlpha?: number; // 0..1\r\n  sweepTiltDeg?: number;\r\n\r\n  edgeGlow?: boolean;\r\n  edgeGlowColor?: number;\r\n  edgeGlowStrength?: number;\r\n  edgeGlowSpeed?: number; // cycles/sec\r\n}\r\n\r\nexport default class HoloFoilFilter {\r\n  url: string;\r\n  alpha: number;\r\n  radius: number;\r\n\r\n  bloom: boolean;\r\n  bloomStrength: number;\r\n  bloomLevels: number;\r\n\r\n  sweep: boolean;\r\n  sweepWidth: number;\r\n  sweepSpeed: number;\r\n  sweepInterval: number;\r\n  sweepAlpha: number;\r\n  sweepTiltDeg: number;\r\n\r\n  edgeGlow: boolean;\r\n  edgeGlowColor: number;\r\n  edgeGlowStrength: number;\r\n  edgeGlowSpeed: number;\r\n\r\n  sprite: any;\r\n  mask: any;\r\n  private _children: any[] = [];\r\n  private _tickerFn?: (d: number) => void;\r\n  private _rafId: number | null = null;\r\n  private _t = 0;\r\n\r\n  private _sweepG?: any;\r\n  private _sweepCooldown = 0;\r\n  private _sweepActive = false;\r\n  private _edge?: any;\r\n\r\n  constructor(url: string, opts: HoloOpts = {}) {\r\n    this.url = url || '';\r\n    this.alpha = opts.alpha ?? 0.28;\r\n    this.radius = opts.radius ?? 20;\r\n\r\n    this.bloom = !!opts.bloom;\r\n    this.bloomStrength = opts.bloomStrength ?? 1.2;\r\n    this.bloomLevels = Math.max(0, Math.floor(opts.bloomLevels ?? 1));\r\n\r\n    this.sweep = opts.sweep ?? true;\r\n    this.sweepWidth = Math.max(40, Math.floor(opts.sweepWidth ?? 160));\r\n    this.sweepSpeed = opts.sweepSpeed ?? 48;\r\n    this.sweepInterval = opts.sweepInterval ?? 8.0;\r\n    this.sweepAlpha = opts.sweepAlpha ?? 0.22;\r\n    this.sweepTiltDeg = opts.sweepTiltDeg ?? -16;\r\n\r\n    this.edgeGlow = opts.edgeGlow ?? true;\r\n    this.edgeGlowColor = opts.edgeGlowColor ?? 0xffffff;\r\n    this.edgeGlowStrength = opts.edgeGlowStrength ?? 0.35;\r\n    this.edgeGlowSpeed = opts.edgeGlowSpeed ?? 0.6;\r\n\r\n    this.sprite = null;\r\n    this.mask = null;\r\n  }\r\n\r\n  async install(target: any, width: number, height: number): Promise<any> {\r\n    if (!this.url) return null;\r\n    const tex = await Assets.load(this.url);\r\n\r\n    const root = new Container();\r\n    (root).eventMode = 'none';\r\n\r\n    // Bloom layers behind main\r\n    if (this.bloom && this.bloomLevels > 0) {\r\n      for (let i = 0; i < this.bloomLevels; i++) {\r\n        const b = new Sprite(tex);\r\n        b.width = Math.round(width);\r\n        b.height = Math.round(height);\r\n        b.alpha = (this.alpha * 0.5) / this.bloomLevels;\r\n        (b).eventMode = 'none';\r\n        const blur = new BlurFilter();\r\n        blur.quality = 1;\r\n        blur.strength = (i + 1) * 6 * (this.bloomStrength ?? 1);\r\n        b.filters = [blur];\r\n        root.addChild(b);\r\n        this._children.push(b);\r\n      }\r\n    }\r\n\r\n    // Main overlay\r\n    const spr = new Sprite(tex);\r\n    spr.width = Math.round(width);\r\n    spr.height = Math.round(height);\r\n    spr.alpha = this.alpha;\r\n    (spr).eventMode = 'none';\r\n    root.addChild(spr);\r\n    this._children.push(spr);\r\n\r\n    // Rounded mask\r\n    const mask = new Graphics()\r\n      .roundRect(0, 0, Math.round(width), Math.round(height), this.radius)\r\n      .fill(0xffffff);\r\n\r\n    target.addChild(root, mask);\r\n    (root).mask = mask;\r\n\r\n    // Edge glow pulse\r\n    if (this.edgeGlow) {\r\n      const e = new Graphics()\r\n        .roundRect(0, 0, Math.round(width), Math.round(height), this.radius)\r\n        .stroke({ color: this.edgeGlowColor, width: 3, alpha: 0.0 });\r\n      (e).eventMode = 'none';\r\n      root.addChild(e);\r\n      this._edge = e;\r\n    }\r\n\r\n    // Light sweep (slanted blurred bar)\r\n    if (this.sweep) {\r\n      const barH = Math.round(height * 1.2);\r\n      const g = new Graphics().rect(0, 0, this.sweepWidth, barH).fill(0xffffff);\r\n      (g).eventMode = 'none';\r\n      g.alpha = 0.0;\r\n      g.pivot.set(this.sweepWidth / 2, Math.round(barH * 0.5));\r\n      g.rotation = (this.sweepTiltDeg * Math.PI) / 180;\r\n      const blur = new BlurFilter();\r\n      blur.quality = 1;\r\n      blur.strength = 8;\r\n      (g).filters = [blur];\r\n      root.addChild(g);\r\n      this._sweepG = g;\r\n      this._sweepCooldown = 0; // show one immediately\r\n    }\r\n\r\n    // IMPORTANT: assign sprite BEFORE starting loops\r\n    this.sprite = root;\r\n    this.mask = mask;\r\n\r\n    // Ticker + RAF fallback (both)\r\n    this._tickerFn = (delta: number) => this._tick(delta / 60, width, height);\r\n    Ticker.shared.add(this._tickerFn);\r\n    Ticker.shared.start();\r\n\r\n    const rafLoop = () => {\r\n      // always schedule next frame; _tick is cheap\r\n      this._tick(1 / 60, width, height);\r\n      this._rafId = requestAnimationFrame(rafLoop as any);\r\n    };\r\n    this._rafId = requestAnimationFrame(rafLoop as any);\r\n\r\n    return root;\r\n  }\r\n\r\n  private _tick(dt: number, width: number, height: number) {\r\n    this._t += dt;\r\n\r\n    // Edge glow pulse\r\n    if (this._edge) {\r\n      const a =\r\n        (Math.sin(this._t * Math.PI * 2 * this.edgeGlowSpeed) + 1) * 0.5;\r\n      this._edge.alpha = a * this.edgeGlowStrength;\r\n    }\r\n\r\n    // Light sweep lifecycle\r\n    if (this._sweepG) {\r\n      if (!this._sweepActive) {\r\n        this._sweepCooldown -= dt;\r\n        if (this._sweepCooldown <= 0) {\r\n          this._sweepActive = true;\r\n          this._sweepG.alpha = this.sweepAlpha;\r\n          this._sweepG.x = -this.sweepWidth;\r\n          this._sweepG.y = Math.round(height * 0.5);\r\n        }\r\n      } else {\r\n        this._sweepG.x += this.sweepSpeed * dt;\r\n        if (this._sweepG.x > width + this.sweepWidth) {\r\n          this._sweepActive = false;\r\n          this._sweepG.alpha = 0.0;\r\n          this._sweepCooldown = this.sweepInterval;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  updateParallax(nx: number, ny: number, strength: number) {\r\n    if (!this.sprite) return;\r\n    this.sprite.x = Math.round(-nx * strength);\r\n    this.sprite.y = Math.round(-ny * strength);\r\n  }\r\n\r\n  destroy() {\r\n    if (this._tickerFn) Ticker.shared.remove(this._tickerFn);\r\n    if (this._rafId != null) cancelAnimationFrame(this._rafId);\r\n    try {\r\n      this._children.forEach((c: any) => c.destroy?.());\r\n    } catch {}\r\n    try {\r\n      this._sweepG?.destroy?.();\r\n    } catch {}\r\n    try {\r\n      this._edge?.destroy?.();\r\n    } catch {}\r\n    try {\r\n      this.sprite?.destroy?.();\r\n    } catch {}\r\n    try {\r\n      this.mask?.destroy?.();\r\n    } catch {}\r\n    this._children = [];\r\n    this._sweepG = undefined;\r\n    this._edge = undefined;\r\n    this.sprite = null;\r\n    this.mask = null;\r\n  }\r\n\r\n  get uniforms() {\r\n    return { uMouse: new Float32Array([0, 0]), uTime: 0 };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}